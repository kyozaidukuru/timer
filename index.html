<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>æ®‹ã‚Šæ™‚é–“ãŒã¿ãˆã‚‹å­¦ç¿’ã‚¿ã‚¤ãƒãƒ¼</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="iconsmall.png" type="image/png">

<style>
:root {
  --bg: #ffffff;
  --fg: #111;
  --arc: rgb(51,204,153);
}
body.dark {
  --bg: #111;
  --fg: #f5f5f5;
  --arc: rgb(247,148,40);
}
body {
  margin:0;
  background:var(--bg);
  color:var(--fg);
  font-family:sans-serif;
  text-align:center;
}
header {
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  margin-top:16px;
}
header img { height:48px; }
#controls {
  display:flex;
  justify-content:center;
  gap:10px;
  margin:10px 0;
}
button {
  font-size:16px;
  padding:8px 16px;
  border-radius:20px;
}
#lockBtn.locked {
  background:red;
  color:white;
}
canvas { display:block; margin:0 auto; }
footer {
  max-width:700px;
  margin:20px auto;
  text-align:left;
  font-size:14px;
}
</style>
</head>

<body>
<header>
  <img src="iconsmall.png">
  <h1>æ®‹ã‚Šæ™‚é–“ãŒã¿ãˆã‚‹å­¦ç¿’ã‚¿ã‚¤ãƒãƒ¼</h1>
  <img src="iconsmall.png">
</header>

<div id="controls">
  <button id="fsBtn">ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³</button>
  <button id="lockBtn">å›ºå®š</button>
  <button id="modeBtn">ğŸŒ™ ãƒ€ãƒ¼ã‚¯</button>
</div>

<canvas id="timer"></canvas>

<footer>
<h3>ã”åˆ©ç”¨ã«ã¤ã„ã¦</h3>
<p>
æœ¬ãƒ„ãƒ¼ãƒ«ã®ã”åˆ©ç”¨ã¯å®Œå…¨ã«ç„¡æ–™ã§ã™ã€‚é–‹ç™ºè€…ã¯ã„ã‹ãªã‚‹å½¢ã§ã‚‚å¯¾ä¾¡ã‚’æ±‚ã‚ã¾ã›ã‚“ã€‚<br>
æœ¬ãƒ„ãƒ¼ãƒ«ã¯å•†ç”¨åˆ©ç”¨ã‚’å«ã‚ã¦ã”è‡ªç”±ã«åˆ©ç”¨ã§ãã¾ã™ã€‚<br>
æœ¬ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãŸã“ã¨ã«ã‚ˆã‚‹ã„ã‹ãªã‚‹æå®³ã«ã¤ã„ã¦ã‚‚é–‹ç™ºè€…ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚
</p>

<h3>æ¨©åˆ©è¡¨è¨˜</h3>
<p>
éŸ³æºã¯ã‚ªãƒˆãƒ­ã‚¸ãƒƒã‚¯(CC BY 4.0)ã‹ã‚‰ãŠå€Ÿã‚Šã—ã¾ã—ãŸã€‚  
<a href="https://otologic.jp/" target="_blank">https://otologic.jp/</a>
</p>
</footer>

<script>
const canvas = document.getElementById("timer");
const ctx = canvas.getContext("2d");
let locked=false, total=0, remain=0, last=0;
const clickSound=new Audio("click.mp3");
const finishSound=new Audio("finish.mp3");

function resize(){
  const v=window.visualViewport;
  const size=Math.min(v.width,v.height*0.8);
  canvas.width=canvas.height=size;
  draw();
}
window.addEventListener("resize",resize);

function draw(){
  const r=canvas.width/2;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.translate(r,r);
  ctx.strokeStyle=getComputedStyle(document.body).getPropertyValue('--fg');
  ctx.lineWidth=4;
  ctx.beginPath(); ctx.arc(0,0,r*0.9,0,Math.PI*2); ctx.stroke();

  // arc
  if(remain>0){
    ctx.fillStyle=getComputedStyle(document.body).getPropertyValue('--arc');
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,r*0.75,-Math.PI/2, -Math.PI/2+remain*6*Math.PI/180);
    ctx.fill();
  }

  // hand
  let a=-Math.PI/2+remain*6*Math.PI/180;
  ctx.strokeStyle="red"; ctx.lineWidth=4;
  ctx.beginPath();
  ctx.moveTo(0,0);
  ctx.lineTo(Math.cos(a)*r*0.7,Math.sin(a)*r*0.7);
  ctx.stroke();
  ctx.fillStyle="red";
  ctx.beginPath(); ctx.arc(0,0,10,0,Math.PI*2); ctx.fill();

  // numbers
  ctx.fillStyle=getComputedStyle(document.body).getPropertyValue('--fg');
  ctx.font=`${r*0.12}px sans-serif`;
  for(let i=0;i<12;i++){
    let ang=i*Math.PI/6-Math.PI/2;
    let x=Math.cos(ang)*r*0.95;
    let y=Math.sin(ang)*r*0.95;
    ctx.fillText(i*5,x-ctx.measureText(i*5).width/2,y+6);
  }
  ctx.setTransform(1,0,0,1,0,0);
}

canvas.addEventListener("click",e=>{
  if(locked) return;
  const r=canvas.width/2;
  const x=e.offsetX-r, y=e.offsetY-r;
  let a=Math.atan2(y,x)+Math.PI/2;
  if(a<0)a+=Math.PI*2;
  total=Math.round(a*180/Math.PI/6);
  remain=total;
  clickSound.play();
});

function tick(t){
  if(!last) last=t;
  let d=(t-last)/1000; last=t;
  if(remain>0){
    remain-=d/60;
    if(remain<=0){
      remain=0;
      finishSound.play();
      navigator.vibrate?.([200,100,200]);
    }
  }
  draw();
  requestAnimationFrame(tick);
}
requestAnimationFrame(tick);

document.getElementById("lockBtn").onclick=()=>{
  locked=!locked;
  const b=document.getElementById("lockBtn");
  b.textContent=locked?"å›ºå®šä¸­":"å›ºå®š";
  b.classList.toggle("locked",locked);
};
document.getElementById("modeBtn").onclick=()=>{
  document.body.classList.toggle("dark");
};
document.getElementById("fsBtn").onclick=()=>{
  document.documentElement.requestFullscreen();
};

resize();

// service worker
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js');
}
</script>
</body>
</html>
