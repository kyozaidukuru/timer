<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>残り時間がみえる学習タイマー</title>
<style>
  body {
    font-family: sans-serif;
    margin: 0;
    background: #ffffff;
    text-align: center;
  }

  h1 { margin-top: 20px; }
  .container { max-width: 700px; margin: 0 auto; }

  #timerWrapper {
    margin: 20px auto;
    width: 100%;
    display: flex;
    justify-content: center;
  }

  canvas {
    background: #fff;
    touch-action: none;
  }

  button {
    margin: 10px;
    padding: 10px 18px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #000;
    background: #fff;
    cursor: pointer;
  }

  #fullscreenBtn {
    border-radius: 20px;
  }

  #lockBtn.locked {
    background: red;
    color: #fff;
  }

  #credit {
    font-size: 14px;
    margin-top: 20px;
    text-align: left;
  }

  /* フルスクリーン用 */
  .fullscreen-mode {
    background: #ffffff;
  }

  .fullscreen-mode h1,
  .fullscreen-mode #desc,
  .fullscreen-mode #buttons,
  .fullscreen-mode #credit {
    display: none;
  }

  #closeFullscreen {
    display: none;
    position: fixed;
    top: 10px;
    right: 14px;
    font-size: 32px;
    background: none;
    border: none;
    cursor: pointer;
    z-index: 1000;
  }

  .fullscreen-mode #closeFullscreen {
    display: block;
  }
</style>
</head>
<body>
<div class="container" id="pageRoot">
  <h1>残り時間がみえる学習タイマー</h1>
  <div id="desc">
    <p><b>使い方</b></p>
    <p>学習したい時間をおすと、タイマーがセットされます。少しずつ時間がへっていきます。<br>
    一度セットしたタイマーは、再度押すことで残り時間を変更できます。<br>
    『固定』ボタンを押すと、時間の変更ができなくなります。</p>
  </div>

  <div id="timerWrapper">
    <canvas id="timerCanvas" width="500" height="500"></canvas>
  </div>

  <div id="buttons">
    <button id="fullscreenBtn">フルスクリーン表示</button>
    <button id="lockBtn">固定</button>
  </div>

  <button id="closeFullscreen">×</button>

  <div id="credit">
    <h3>ご利用について</h3>
    <p>
      本ツールのご利用は完全に無料です。開発者はいかなる形でも対価を求めません。<br>
      本ツールは商用利用を含めてご自由に利用できます。<br>
      本ツールを利用したことによる、いかなる損害についても開発者は一切の責任を負いません。
    </p>

    <h3>権利表記</h3>
    <p>
      音源はオトロジック(CC BY 4.0)からお借りしました。  
      <a href="https://otologic.jp/" target="_blank">https://otologic.jp/</a>
    </p>
  </div>
</div>

<script>
const canvas = document.getElementById("timerCanvas");
const ctx = canvas.getContext("2d");
const lockBtn = document.getElementById("lockBtn");
const fullscreenBtn = document.getElementById("fullscreenBtn");
const closeFullscreen = document.getElementById("closeFullscreen");
const pageRoot = document.getElementById("pageRoot");

let locked = false;
let totalSeconds = 0;
let remainingSeconds = 0;
let timerId = null;

function drawTimer() {
  const w = canvas.width, h = canvas.height;
  const cx = w/2, cy = h/2;
  const r = Math.min(w,h)*0.4;

  ctx.clearRect(0,0,w,h);

  // 外枠
  ctx.strokeStyle = "#000";
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.arc(cx,cy,r,0,Math.PI*2);
  ctx.stroke();

  // 円弧（残り）
  if (remainingSeconds > 0) {
    const angle = (remainingSeconds/60)*6 * Math.PI/180;
    ctx.fillStyle = "rgb(51,204,153)";
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r,-Math.PI/2, -Math.PI/2 + angle, false);
    ctx.closePath();
    ctx.fill();
  }

  // 目盛りと数字
  ctx.fillStyle = "#000";
  ctx.font = "18px sans-serif";
  for (let i=0;i<60;i++) {
    const a = -Math.PI/2 + i*2*Math.PI/60;
    const x1 = cx + Math.cos(a)*(r-10);
    const y1 = cy + Math.sin(a)*(r-10);
    const x2 = cx + Math.cos(a)*(r);
    const y2 = cy + Math.sin(a)*(r);
    ctx.beginPath();
    ctx.moveTo(x1,y1);
    ctx.lineTo(x2,y2);
    ctx.stroke();

    if (i%5===0) {
      const tx = cx + Math.cos(a)*(r+26);
      const ty = cy + Math.sin(a)*(r+26);
      ctx.fillText(i.toString(), tx-8, ty+6);
    }
  }

  // 針
  const a2 = -Math.PI/2 + (remainingSeconds/60)*6*Math.PI/180;
  ctx.strokeStyle = remainingSeconds>0 ? "red":"gray";
  ctx.lineWidth = 5;
  ctx.beginPath();
  ctx.moveTo(cx,cy);
  ctx.lineTo(cx+Math.cos(a2)*(r-20), cy+Math.sin(a2)*(r-20));
  ctx.stroke();

  ctx.fillStyle="#000";
  ctx.beginPath();
  ctx.arc(cx,cy,10,0,Math.PI*2);
  ctx.fill();
}

canvas.addEventListener("click", e=>{
  if (locked) return;
  const rect=canvas.getBoundingClientRect();
  const x=e.clientX-rect.left, y=e.clientY-rect.top;
  const dx=x-canvas.width/2, dy=y-canvas.height/2;
  let ang=Math.atan2(dy,dx)+Math.PI/2;
  if(ang<0)ang+=2*Math.PI;
  const min=Math.round(ang*60/(2*Math.PI));
  startTimer(min*60);
});

function startTimer(sec){
  clearInterval(timerId);
  totalSeconds=sec;
  remainingSeconds=sec;
  drawTimer();
  timerId=setInterval(()=>{
    remainingSeconds--;
    if(remainingSeconds<=0){
      clearInterval(timerId);
      remainingSeconds=0;
    }
    drawTimer();
  },1000);
}

lockBtn.onclick=()=>{
  locked=!locked;
  lockBtn.textContent=locked?"固定中":"固定";
  lockBtn.classList.toggle("locked",locked);
};

fullscreenBtn.onclick=()=>{
  pageRoot.classList.add("fullscreen-mode");
};

closeFullscreen.onclick=()=>{
  pageRoot.classList.remove("fullscreen-mode");
};

drawTimer();
</script>
</body>
</html>
