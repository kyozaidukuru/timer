<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>æ®‹ã‚Šæ™‚é–“ãŒã¿ãˆã‚‹å­¦ç¿’ã‚¿ã‚¤ãƒãƒ¼</title>
<style>
  body {
    font-family: sans-serif;
    margin: 0;
    background: #ffffff;
    text-align: center;
  }

  h1 { margin-top: 20px; }
  .container { max-width: 900px; margin: 0 auto; }

  #timerWrapper {
    margin: 20px auto;
    width: 100%;
    display: flex;
    justify-content: center;
  }

  canvas {
    background: #fff;
    touch-action: none;
    display: block;
  }

  button {
    margin: 10px;
    padding: 10px 18px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #000;
    background: #fff;
    cursor: pointer;
  }

  #fullscreenBtn { border-radius: 20px; }

  #lockBtn.locked {
    background: red;
    color: #fff;
  }

  #credit {
    font-size: 14px;
    margin-top: 20px;
    text-align: left;
  }

  /* ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ç”¨ */
  .fullscreen-mode {
    background: #ffffff;
  }

  .fullscreen-mode h1,
  .fullscreen-mode #desc,
  .fullscreen-mode #buttons,
  .fullscreen-mode #credit {
    display: none;
  }

  #closeFullscreen {
    display: none;
    position: fixed;
    top: 10px;
    right: 14px;
    font-size: 32px;
    background: none;
    border: none;
    cursor: pointer;
    z-index: 1000;
  }

  .fullscreen-mode #closeFullscreen {
    display: block;
  }
</style>
</head>
<body>
<div class="container" id="pageRoot">
  <h1>æ®‹ã‚Šæ™‚é–“ãŒã¿ãˆã‚‹å­¦ç¿’ã‚¿ã‚¤ãƒãƒ¼</h1>
  <div id="desc">
    <p><b>ä½¿ã„æ–¹</b></p>
    <p>
      å­¦ç¿’ã—ãŸã„æ™‚é–“ã‚’ãŠã™ã¨ã€ã‚¿ã‚¤ãƒãƒ¼ãŒã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚å°‘ã—ãšã¤æ™‚é–“ãŒã¸ã£ã¦ã„ãã®ãŒè¦‹ãˆã¾ã™ã€‚<br>
      ä¸€åº¦ã‚»ãƒƒãƒˆã—ãŸã‚¿ã‚¤ãƒãƒ¼ã¯ã€å†åº¦æŠ¼ã™ã“ã¨ã§æ®‹ã‚Šæ™‚é–“ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚<br>
      ã€å›ºå®šã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€æ™‚é–“ã®å¤‰æ›´ãŒã§ããªããªã‚Šã¾ã™ã€‚
    </p>
  </div>

  <div id="timerWrapper">
    <canvas id="timerCanvas"></canvas>
  </div>

  <div id="buttons">
    <button id="fullscreenBtn">ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¡¨ç¤º</button>
    <button id="lockBtn">å›ºå®š</button>
  </div>

  <button id="closeFullscreen">Ã—</button>

  <div id="credit">
    <h3>ã”åˆ©ç”¨ã«ã¤ã„ã¦</h3>
    <p>
      æœ¬ãƒ„ãƒ¼ãƒ«ã®ã”åˆ©ç”¨ã¯å®Œå…¨ã«ç„¡æ–™ã§ã™ã€‚é–‹ç™ºè€…ã¯ã„ã‹ãªã‚‹å½¢ã§ã‚‚å¯¾ä¾¡ã‚’æ±‚ã‚ã¾ã›ã‚“ã€‚<br>
      æœ¬ãƒ„ãƒ¼ãƒ«ã¯å•†ç”¨åˆ©ç”¨ã‚’å«ã‚ã¦ã”è‡ªç”±ã«åˆ©ç”¨ã§ãã¾ã™ã€‚<br>
      æœ¬ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãŸã“ã¨ã«ã‚ˆã‚‹ã„ã‹ãªã‚‹æå®³ã«ã¤ã„ã¦ã‚‚é–‹ç™ºè€…ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚
    </p>

    <h3>æ¨©åˆ©è¡¨è¨˜</h3>
    <p>
      éŸ³æºã¯ã‚ªãƒˆãƒ­ã‚¸ãƒƒã‚¯(CC BY 4.0)ã‹ã‚‰ãŠå€Ÿã‚Šã—ã¾ã—ãŸã€‚  
      <a href="https://otologic.jp/" target="_blank">https://otologic.jp/</a>
    </p>
  </div>
</div>

<script>
const canvas = document.getElementById("timerCanvas");
const ctx = canvas.getContext("2d");
const lockBtn = document.getElementById("lockBtn");
const fullscreenBtn = document.getElementById("fullscreenBtn");
const closeFullscreen = document.getElementById("closeFullscreen");
const pageRoot = document.getElementById("pageRoot");
const timerWrapper = document.getElementById("timerWrapper");

// ğŸ”Š éŸ³å£°
const clickSound = new Audio("click.mp3");
const finishSound = new Audio("finish.mp3");
let audioUnlocked = false;

function unlockAudio() {
  if (audioUnlocked) return;
  audioUnlocked = true;
  clickSound.play().then(() => {
    clickSound.pause();
    clickSound.currentTime = 0;
  }).catch(()=>{});
}

let locked = false;
let remainingSeconds = 0;
let timerId = null;

// â˜… ç”»é¢ã‚µã‚¤ã‚ºã«åˆã‚ã›ã¦ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ãƒªã‚µã‚¤ã‚º
function resizeCanvas() {
  const size = Math.min(timerWrapper.clientWidth, window.innerHeight * 0.8);
  canvas.width = size;
  canvas.height = size;
  drawTimer();
}

function drawTimer() {
  const w = canvas.width, h = canvas.height;
  const cx = w / 2, cy = h / 2;
  const r = Math.min(w, h) * 0.40;   // å°‘ã—å†…å´å¯„ã‚Š

  ctx.clearRect(0, 0, w, h);

  // å¤–æ 
  ctx.strokeStyle = "#000";
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.arc(cx, cy, r, 0, Math.PI * 2);
  ctx.stroke();

  // æ®‹ã‚Šæ™‚é–“ã®å††å¼§ï¼ˆã•ã‚‰ã«å°‘ã—å†…å´ï¼‰
  if (remainingSeconds > 0) {
    const angle = (remainingSeconds / 60) * 6 * Math.PI / 180;
    ctx.fillStyle = "rgb(51,204,153)";
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, r - 16, -Math.PI / 2, -Math.PI / 2 + angle, false);
    ctx.closePath();
    ctx.fill();
  }

  // ç›®ç››ã‚Šã¨æ•°å­—
  ctx.fillStyle = "#000";
  ctx.font = "28px sans-serif";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";

  for (let i = 0; i < 60; i++) {
    const a = -Math.PI / 2 + i * 2 * Math.PI / 60;

    // ãƒ¡ãƒ¢ãƒªé•·ã•ï¼š2å€
    const tickLen = i % 5 === 0 ? 28 : 16;

    const x1 = cx + Math.cos(a) * (r - tickLen);
    const y1 = cy + Math.sin(a) * (r - tickLen);
    const x2 = cx + Math.cos(a) * r;
    const y2 = cy + Math.sin(a) * r;

    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();

    if (i % 5 === 0) {
      // â˜… æ•°å­—ã¯â€œå†…å´â€ã«å¯„ã›ã¦è¦‹åˆ‡ã‚Œé˜²æ­¢
      const tx = cx + Math.cos(a) * (r + 30);
      const ty = cy + Math.sin(a) * (r + 30);
      ctx.fillText(i.toString(), tx, ty);
    }
  }

  // é‡
  const a2 = -Math.PI / 2 + (remainingSeconds / 60) * 6 * Math.PI / 180;
  ctx.strokeStyle = remainingSeconds > 0 ? "red" : "gray";
  ctx.lineWidth = 6;
  ctx.beginPath();
  ctx.moveTo(cx, cy);
  ctx.lineTo(cx + Math.cos(a2) * (r - 36), cy + Math.sin(a2) * (r - 36));
  ctx.stroke();

  // ä¸­å¿ƒå††
  ctx.fillStyle = "#000";
  ctx.beginPath();
  ctx.arc(cx, cy, 14, 0, Math.PI * 2);
  ctx.fill();
}

canvas.addEventListener("click", e => {
  unlockAudio();
  if (locked) return;

  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  const dx = x - canvas.width / 2;
  const dy = y - canvas.height / 2;
  let ang = Math.atan2(dy, dx) + Math.PI / 2;
  if (ang < 0) ang += 2 * Math.PI;
  const min = Math.round(ang * 60 / (2 * Math.PI));
  startTimer(min * 60);
});

function startTimer(sec) {
  clearInterval(timerId);
  remainingSeconds = sec;

  clickSound.currentTime = 0;
  clickSound.play().catch(()=>{});

  drawTimer();
  timerId = setInterval(() => {
    remainingSeconds--;
    if (remainingSeconds <= 0) {
      clearInterval(timerId);
      remainingSeconds = 0;
      finishSound.currentTime = 0;
      finishSound.play().catch(()=>{});
    }
    drawTimer();
  }, 1000);
}

lockBtn.onclick = () => {
  locked = !locked;
  lockBtn.textContent = locked ? "å›ºå®šä¸­" : "å›ºå®š";
  lockBtn.classList.toggle("locked", locked);
};

fullscreenBtn.onclick = () => {
  pageRoot.classList.add("fullscreen-mode");
  resizeCanvas(); // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³æ™‚ã«å†è¨ˆç®—
};

closeFullscreen.onclick = () => {
  pageRoot.classList.remove("fullscreen-mode");
  resizeCanvas(); // æˆ»ã£ãŸã¨ãã‚‚å†è¨ˆç®—
};

window.addEventListener("resize", resizeCanvas);

// åˆæœŸåŒ–
resizeCanvas();
</script>
</body>
</html>
