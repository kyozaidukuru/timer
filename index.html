<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>æ®‹ã‚Šæ™‚é–“ãŒã¿ãˆã‚‹å­¦ç¿’ã‚¿ã‚¤ãƒãƒ¼</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="iconsmall.png">

<style>
:root {
  --bg:#fff; --fg:#111; --arc:rgb(51,204,153);
}
body.dark {
  --bg:#111; --fg:#f5f5f5; --arc:rgb(247,148,40);
}
body { margin:0; background:var(--bg); color:var(--fg); font-family:sans-serif; text-align:center; }

header {
  display:flex; align-items:center; justify-content:center; gap:12px; margin-top:16px;
}
header img { height:48px; }

#desc { max-width:720px; margin:12px auto; text-align:left; line-height:1.6; padding: 0 10px; }

canvas { display:block; margin:8px auto; cursor: pointer; }

#controls {
  display:flex; justify-content:center; gap:12px; margin:10px 0 16px;
}
button {
  padding:8px 18px; font-size:16px; border-radius:20px; cursor: pointer;
}
#lockBtn.locked { background:red; color:#fff; }

footer { max-width:720px; margin:20px auto; text-align:left; font-size:14px; padding: 0 10px; }
</style>
</head>

<body>
<header>
  <img src="iconsmall.png">
  <h1>æ®‹ã‚Šæ™‚é–“ãŒã¿ãˆã‚‹å­¦ç¿’ã‚¿ã‚¤ãƒãƒ¼</h1>
  <img src="iconsmall.png">
</header>

<div id="desc">
<b>ä½¿ã„æ–¹</b><br>
æ™‚è¨ˆç›¤ã‚’æŠ¼ã™ã¨ã€ã‚¿ã‚¤ãƒãƒ¼ãŒã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚<br>
å°‘ã—ãšã¤æ™‚é–“ãŒã¸ã£ã¦ã„ãã®ãŒè¦‹ãˆã¾ã™ã€‚<br>
ã€Œå›ºå®šã€ãƒœã‚¿ãƒ³ã§èª¤æ“ä½œã‚’é˜²ã’ã¾ã™ã€‚
</div>

<canvas id="timer"></canvas>

<div id="controls">
  <button id="fsBtn">ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³</button>
  <button id="lockBtn">å›ºå®š</button>
  <button id="modeBtn">ğŸŒ™ ãƒ€ãƒ¼ã‚¯</button>
</div>

<footer>
<h3>ã”åˆ©ç”¨ã«ã¤ã„ã¦</h3>
<p>
æœ¬ãƒ„ãƒ¼ãƒ«ã®ã”åˆ©ç”¨ã¯å®Œå…¨ã«ç„¡æ–™ã§ã™ã€‚å•†ç”¨åˆ©ç”¨ã‚‚è‡ªç”±ã§ã™ã€‚
</p>
<h3>æ¨©åˆ©è¡¨è¨˜</h3>
<p>
éŸ³æºã¯ã‚ªãƒˆãƒ­ã‚¸ãƒƒã‚¯(CC BY 4.0)ã‹ã‚‰ãŠå€Ÿã‚Šã—ã¾ã—ãŸã€‚
</p>
</footer>

<script>
const canvas = document.getElementById("timer");
const ctx = canvas.getContext("2d");
let locked = false, remain = 0, last = 0;

// éŸ³æºï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼‰
const clickSound = new Audio("click.mp3");
const finishSound = new Audio("finish.mp3");

function resize() {
  const v = window.visualViewport;
  // å††ç›¤ã‚’å¤§ããï¼ˆç”»é¢å¹…ã®95%ã‹ã€é«˜ã•ã®75%ã®å°ã•ã„æ–¹ï¼‰
  const size = Math.min(v.width * 0.95, v.height * 0.75);
  canvas.width = canvas.height = size;
  draw();
}
window.addEventListener("resize", resize);

function draw() {
  const r = canvas.width / 2;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.translate(r, r);

  const style = getComputedStyle(document.body);
  const fg = style.getPropertyValue('--fg');
  const arcColor = style.getPropertyValue('--arc');

  // å¤–æ 
  ctx.strokeStyle = fg;
  ctx.lineWidth = 4;
  ctx.beginPath(); ctx.arc(0, 0, r * 0.85, 0, Math.PI * 2); ctx.stroke();

  // ç›®ç››ã‚Š
  for (let i = 0; i < 60; i++) {
    let a = i * Math.PI / 30 - Math.PI / 2;
    let len = i % 5 === 0 ? r * 0.08 : r * 0.04;
    ctx.beginPath();
    ctx.moveTo(Math.cos(a) * (r * 0.75), Math.sin(a) * (r * 0.75));
    ctx.lineTo(Math.cos(a) * (r * 0.75 + len), Math.sin(a) * (r * 0.75 + len));
    ctx.stroke();
  }

  // å††å¼§ï¼ˆæ®‹ã‚Šæ™‚é–“ï¼‰
  if (remain > 0) {
    ctx.fillStyle = arcColor;
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.arc(0, 0, r * 0.73, -Math.PI / 2, -Math.PI / 2 + remain * 6 * Math.PI / 180);
    ctx.fill();
  }

  // é‡
  let a = -Math.PI / 2 + remain * 6 * Math.PI / 180;
  ctx.strokeStyle = "red"; ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(0, 0);
  ctx.lineTo(Math.cos(a) * r * 0.70, Math.sin(a) * r * 0.70);
  ctx.stroke();
  ctx.fillStyle = "red";
  ctx.beginPath(); ctx.arc(0, 0, 8, 0, Math.PI * 2); ctx.fill();

  // æ•°å­—
  ctx.fillStyle = fg;
  ctx.font = `bold ${r * 0.1}px sans-serif`;
  for (let i = 0; i < 12; i++) {
    let ang = i * Math.PI / 6 - Math.PI / 2;
    let x = Math.cos(ang) * r * 0.92;
    let y = Math.sin(ang) * r * 0.92;
    let t = i * 5;
    let w = ctx.measureText(t).width;
    ctx.fillText(t, x - w / 2, y + (r * 0.04));
  }

  ctx.setTransform(1, 0, 0, 1, 0, 0);
}

canvas.onclick = e => {
  if (locked) return;

  // ãƒ–ãƒ©ã‚¦ã‚¶ã®éŸ³å†ç”Ÿåˆ¶é™ã‚’è§£é™¤ã™ã‚‹ãŸã‚ã®å„€å¼
  clickSound.play().catch(() => {});
  finishSound.pause(); 
  finishSound.currentTime = 0;

  const rect = canvas.getBoundingClientRect();
  const r = canvas.width / 2;
  let x = (e.clientX - rect.left) - r;
  let y = (e.clientY - rect.top) - r;
  let ang = Math.atan2(y, x) + Math.PI / 2;
  if (ang < 0) ang += Math.PI * 2;
  remain = Math.round(ang * 180 / Math.PI / 6);
  
  clickSound.play();
  draw();
};

function tick(t) {
  if (!last) last = t;
  let d = (t - last) / 1000;
  last = t;

  if (remain > 0) {
    remain -= d / 60;
    if (remain <= 0) {
      remain = 0;
      finishSound.play().catch(e => console.log("éŸ³å†ç”Ÿã‚¨ãƒ©ãƒ¼:", e));
      if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
    }
  }
  draw();
  requestAnimationFrame(tick);
}
requestAnimationFrame(tick);

document.getElementById("lockBtn").onclick = () => {
  locked = !locked;
  const b = document.getElementById("lockBtn");
  b.textContent = locked ? "å›ºå®šä¸­" : "å›ºå®š";
  b.classList.toggle("locked", locked);
};
document.getElementById("modeBtn").onclick = () => {
  document.body.classList.toggle("dark");
  draw();
};
document.getElementById("fsBtn").onclick = () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
};

resize();
</script>
</body>
</html>
