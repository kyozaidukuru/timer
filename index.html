<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>残り時間がみえる学習タイマー</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:system-ui,sans-serif;text-align:center;margin:0;padding:24px}
h1{font-size:1.9rem}
.desc{max-width:700px;margin:0 auto 16px;line-height:1.6}
button{
  padding:10px 20px;font-size:1rem;border:2px solid black;
  background:white;cursor:pointer;border-radius:6px;margin-bottom:16px
}
button.locked{color:red;border-color:red}
svg{width:360px;max-width:95vw;height:auto;touch-action:manipulation}
.number{font-size:18px;fill:black}
.tick{stroke:black;stroke-width:2}
.tick.small{stroke-width:1}
.hand{stroke:red;stroke-width:4;stroke-linecap:round}
.hand.idle{stroke:gray}
.center-circle{fill:white;stroke:black;stroke-width:2}
.arc{fill:rgb(51,204,153)}
</style>
</head>
<body>

<h1>残り時間がみえる学習タイマー</h1>
<div class="desc">
<strong>使い方</strong><br>
学習したい時間をおすと、タイマーがセットされます。少しずつ時間がへっていくのが見えます。<br>
一度セットしたタイマーは、再度押すことで残り時間を変更できます。<br>
『固定』ボタンを押すと、時間の変更ができなくなりますが、もう一度押すことで変更できます。
</div>

<button id="lockBtn">固定</button>

<svg id="timer" viewBox="0 0 360 360">
<circle cx="180" cy="180" r="140" fill="none" stroke="black" stroke-width="4"/>
<path id="arc" class="arc"/>
<g id="ticks"></g>
<g id="numbers"></g>
<line id="hand" class="hand idle" x1="180" y1="180" x2="180" y2="50"/>
<circle cx="180" cy="180" r="14" class="center-circle"/>
</svg>

<script>
const svg=document.getElementById("timer");
const hand=document.getElementById("hand");
const arc=document.getElementById("arc");
const ticks=document.getElementById("ticks");
const numbers=document.getElementById("numbers");
const lockBtn=document.getElementById("lockBtn");

let totalSeconds=0,remainingSeconds=0,timerId=null;
let locked=false;

function polar(cx,cy,r,a){
 const rad=(a-90)*Math.PI/180;
 return{x:cx+r*Math.cos(rad),y:cy+r*Math.sin(rad)}
}
function arcPath(cx,cy,r,a){
 if(a<=0)return"";
 const s=polar(cx,cy,r,a),e=polar(cx,cy,r,0);
 const laf=a<=180?0:1;
 return`M${cx},${cy} L${s.x},${s.y} A${r},${r} 0 ${laf} 0 ${e.x},${e.y} Z`;
}
function drawFace(){
 for(let i=0;i<60;i++){
  const a=i*6,maj=i%5==0;
  const p1=polar(180,180,140,a),p2=polar(180,180,maj?120:130,a);
  const l=document.createElementNS("http://www.w3.org/2000/svg","line");
  l.setAttribute("x1",p1.x);l.setAttribute("y1",p1.y);
  l.setAttribute("x2",p2.x);l.setAttribute("y2",p2.y);
  l.setAttribute("class","tick"+(maj?"":" small"));
  ticks.appendChild(l);
  if(maj){
   const t=document.createElementNS("http://www.w3.org/2000/svg","text");
   const n=polar(180,180,160,a);
   t.setAttribute("x",n.x);t.setAttribute("y",n.y+6);
   t.setAttribute("text-anchor","middle");
   t.setAttribute("class","number");
   t.textContent=i;
   numbers.appendChild(t);
  }
 }
}
function update(sec){
 const a=sec*0.1;
 arc.setAttribute("d",arcPath(180,180,120,a));
 const p=polar(180,180,115,a);
 hand.setAttribute("x2",p.x);hand.setAttribute("y2",p.y);
}
function start(min){
 if(timerId)clearInterval(timerId);
 totalSeconds=min*60;remainingSeconds=totalSeconds;
 hand.classList.remove("idle");update(remainingSeconds);
 timerId=setInterval(()=>{
  remainingSeconds--;
  if(remainingSeconds<=0){clearInterval(timerId);hand.classList.add("idle");update(0);return;}
  update(remainingSeconds);
 },1000);
}

svg.addEventListener("pointerdown",e=>{
 if(locked)return;
 const r=svg.getBoundingClientRect();
 const dx=e.clientX-r.left-r.width/2,dy=e.clientY-r.top-r.height/2;
 let a=Math.atan2(dy,dx)*180/Math.PI+90;if(a<0)a+=360;
 const m=Math.round(a/6);if(m>0)start(m);
});

lockBtn.onclick=()=>{
 locked=!locked;
 lockBtn.textContent=locked?"固定中":"固定";
 lockBtn.className=locked?"locked":"";
};

drawFace();
</script>
</body>
</html>
