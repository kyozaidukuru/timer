<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>æ®‹ã‚Šæ™‚é–“ãŒã¿ãˆã‚‹å­¦ç¿’ã‚¿ã‚¤ãƒãƒ¼</title>
<style>
  :root {
    --bg: #fff;
    --fg: #000;
    --arc: rgb(51,204,153);
  }
  body.dark {
    --bg: #111;
    --fg: #eee;
    --arc: rgb(247,148,40);
  }
  body {
    margin: 0;
    font-family: sans-serif;
    background: var(--bg);
    color: var(--fg);
    text-align: center;
  }
  .container { max-width: 900px; margin: 0 auto; }
  #timerWrapper { margin: 20px auto; display: flex; justify-content: center; }
  canvas { touch-action: none; display: block; }

  button {
    margin: 10px;
    padding: 10px 18px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid var(--fg);
    background: var(--bg);
    color: var(--fg);
    cursor: pointer;
  }
  #fullscreenBtn { border-radius: 20px; }
  #lockBtn.locked { background: red; color: #fff; }

  #closeFullscreen {
    display: none;
    position: fixed;
    top: 10px;
    right: 14px;
    font-size: 32px;
    background: none;
    border: none;
    color: var(--fg);
    z-index: 1000;
  }

  .fullscreen-mode h1,
  .fullscreen-mode #desc,
  .fullscreen-mode #buttons,
  .fullscreen-mode #credit {
    display: none;
  }
  .fullscreen-mode #closeFullscreen { display: block; }

  #desc, #credit {
    text-align: left;
    margin: 20px;
    font-size: 15px;
    line-height: 1.6;
  }
</style>
</head>
<body>
<div class="container" id="pageRoot">
  <h1>æ®‹ã‚Šæ™‚é–“ãŒã¿ãˆã‚‹å­¦ç¿’ã‚¿ã‚¤ãƒãƒ¼</h1>

  <div id="desc">
    <p><b>ä½¿ã„æ–¹</b></p>
    <p>
      å­¦ç¿’ã—ãŸã„æ™‚é–“ã‚’ãŠã™ã¨ã€ã‚¿ã‚¤ãƒãƒ¼ãŒã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚å°‘ã—ãšã¤æ™‚é–“ãŒã¸ã£ã¦ã„ãã®ãŒè¦‹ãˆã¾ã™ã€‚<br>
      ä¸€åº¦ã‚»ãƒƒãƒˆã—ãŸã‚¿ã‚¤ãƒãƒ¼ã¯ã€å†åº¦æŠ¼ã™ã“ã¨ã§æ®‹ã‚Šæ™‚é–“ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚<br>
      ã€å›ºå®šã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€æ™‚é–“ã®å¤‰æ›´ãŒã§ããªããªã‚Šã¾ã™ã€‚
      ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚„ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚
    </p>
  </div>

  <div id="timerWrapper">
    <canvas id="timerCanvas"></canvas>
  </div>

  <div id="buttons">
    <button id="darkBtn">ğŸŒ™ ãƒ€ãƒ¼ã‚¯</button>
    <button id="fullscreenBtn">ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³</button>
    <button id="lockBtn">å›ºå®š</button>
  </div>

  <button id="closeFullscreen">Ã—</button>

  <div id="credit">
    <h3>ã”åˆ©ç”¨ã«ã¤ã„ã¦</h3>
    <p>
      æœ¬ãƒ„ãƒ¼ãƒ«ã®ã”åˆ©ç”¨ã¯å®Œå…¨ã«ç„¡æ–™ã§ã™ã€‚é–‹ç™ºè€…ã¯ã„ã‹ãªã‚‹å½¢ã§ã‚‚å¯¾ä¾¡ã‚’æ±‚ã‚ã¾ã›ã‚“ã€‚<br>
      æœ¬ãƒ„ãƒ¼ãƒ«ã¯å•†ç”¨åˆ©ç”¨ã‚’å«ã‚ã¦ã”è‡ªç”±ã«åˆ©ç”¨ã§ãã¾ã™ã€‚<br>
      æœ¬ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ãŸã“ã¨ã«ã‚ˆã‚‹ã„ã‹ãªã‚‹æå®³ã«ã¤ã„ã¦ã‚‚é–‹ç™ºè€…ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚
    </p>

    <h3>æ¨©åˆ©è¡¨è¨˜</h3>
    <p>
      éŸ³æºã¯ã‚ªãƒˆãƒ­ã‚¸ãƒƒã‚¯(CC BY 4.0)ã‹ã‚‰ãŠå€Ÿã‚Šã—ã¾ã—ãŸã€‚  
      <a href="https://otologic.jp/" target="_blank">https://otologic.jp/</a>
    </p>
  </div>
</div>

<script>
const canvas = document.getElementById("timerCanvas");
const ctx = canvas.getContext("2d");
const lockBtn = document.getElementById("lockBtn");
const fullscreenBtn = document.getElementById("fullscreenBtn");
const darkBtn = document.getElementById("darkBtn");
const closeFullscreen = document.getElementById("closeFullscreen");
const pageRoot = document.getElementById("pageRoot");

const clickSound = new Audio("click.mp3");
const finishSound = new Audio("finish.mp3");

let locked = false;
let remainingSeconds = 0;
let timerId = null;

function resizeCanvas() {
  const dpr = window.devicePixelRatio || 1;
  const size = Math.min(window.innerWidth * 0.9, window.innerHeight * 0.8);
  canvas.style.width = size + "px";
  canvas.style.height = size + "px";
  canvas.width = size * dpr;
  canvas.height = size * dpr;
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  drawTimer();
}

function drawTimer() {
  const w = canvas.width / (window.devicePixelRatio || 1);
  const h = canvas.height / (window.devicePixelRatio || 1);
  const cx = w/2, cy = h/2;
  const r = Math.min(w,h)*0.38;

  ctx.clearRect(0,0,w,h);
  ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--fg');
  ctx.lineWidth = 4;

  ctx.beginPath();
  ctx.arc(cx,cy,r,0,Math.PI*2);
  ctx.stroke();

  if (remainingSeconds>0) {
    const angle = remainingSeconds/60*6*Math.PI/180;
    ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--arc');
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r-18,-Math.PI/2,-Math.PI/2+angle);
    ctx.closePath();
    ctx.fill();
  }

  ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--fg');
  ctx.font = "30px sans-serif";
  ctx.textAlign="center"; ctx.textBaseline="middle";

  for(let i=0;i<60;i++){
    const a=-Math.PI/2+i*2*Math.PI/60;
    const tick=i%5===0?24:12;
    ctx.beginPath();
    ctx.moveTo(cx+Math.cos(a)*(r-tick),cy+Math.sin(a)*(r-tick));
    ctx.lineTo(cx+Math.cos(a)*r,cy+Math.sin(a)*r);
    ctx.stroke();
    if(i%5===0){
      ctx.fillText(i,cx+Math.cos(a)*(r+24),cy+Math.sin(a)*(r+24));
    }
  }

  const a2=-Math.PI/2+remainingSeconds/60*6*Math.PI/180;
  ctx.strokeStyle=remainingSeconds>0?"red":"gray";
  ctx.lineWidth=6;
  ctx.beginPath();
  ctx.moveTo(cx,cy);
  ctx.lineTo(cx+Math.cos(a2)*(r-36),cy+Math.sin(a2)*(r-36));
  ctx.stroke();
}

canvas.onclick = e => {
  if(locked) return;
  clickSound.play().catch(()=>{});
  const rect=canvas.getBoundingClientRect();
  const dx=e.clientX-rect.left-rect.width/2;
  const dy=e.clientY-rect.top-rect.height/2;
  let ang=Math.atan2(dy,dx)+Math.PI/2;
  if(ang<0) ang+=2*Math.PI;
  startTimer(Math.round(ang*60/(2*Math.PI))*60);
};

function startTimer(sec){
  clearInterval(timerId);
  remainingSeconds=sec;
  drawTimer();
  timerId=setInterval(()=>{
    remainingSeconds--;
    if(remainingSeconds<=0){
      clearInterval(timerId);
      remainingSeconds=0;
      finishSound.play().catch(()=>{});
      if(navigator.vibrate) navigator.vibrate(200);
    }
    drawTimer();
  },1000);
}

lockBtn.onclick=()=>{ locked=!locked; lockBtn.textContent=locked?"å›ºå®šä¸­":"å›ºå®š"; lockBtn.classList.toggle("locked",locked); };
fullscreenBtn.onclick=()=>{ pageRoot.classList.add("fullscreen-mode"); resizeCanvas(); };
closeFullscreen.onclick=()=>{ pageRoot.classList.remove("fullscreen-mode"); resizeCanvas(); };
darkBtn.onclick=()=>{ document.body.classList.toggle("dark"); drawTimer(); };

window.onresize=resizeCanvas;
resizeCanvas();
</script>
</body>
</html>
